+ source /mnt/weka/home/hao.zhang/conda/miniconda/bin/activate
++ _CONDA_ROOT=/mnt/weka/home/hao.zhang/conda/miniconda
++ . /mnt/weka/home/hao.zhang/conda/miniconda/etc/profile.d/conda.sh
+++ export CONDA_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda
+++ CONDA_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/python
+++ CONDA_PYTHON_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/python
+++ '[' -z x ']'
++ conda activate
++ local cmd=activate
++ case "$cmd" in
++ __conda_activate activate
++ '[' -n '' ']'
++ local ask_conda
+++ PS1=
+++ __conda_exe shell.posix activate
+++ '[' -n '' ']'
+++ /mnt/weka/home/hao.zhang/conda/miniconda/bin/conda shell.posix activate
++ ask_conda='unset _CE_M
unset _CE_CONDA
PS1='\''(base) '\''
export PATH='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin:/mnt/weka/home/hao.zhang/conda/miniconda/condabin:/mnt/weka/home/hao.zhang/.cursor-server/cli/servers/Stable-53b99ce608cba35127ae3a050c1738a959750860/server/bin/remote-cli:/mnt/weka/home/hao.zhang/.local/bin:/usr/local/bin/wekaenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/weka/software/weka/bin'\''
export CONDA_PREFIX='\''/mnt/weka/home/hao.zhang/conda/miniconda'\''
export CONDA_SHLVL='\''3'\''
export CONDA_DEFAULT_ENV='\''base'\''
export CONDA_PROMPT_MODIFIER='\''(base) '\''
export CONDA_PREFIX_2='\''/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv'\''
export CONDA_EXE='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda'\''
export CONDA_PYTHON_EXE='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin/python'\'''
++ eval 'unset _CE_M
unset _CE_CONDA
PS1='\''(base) '\''
export PATH='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin:/mnt/weka/home/hao.zhang/conda/miniconda/condabin:/mnt/weka/home/hao.zhang/.cursor-server/cli/servers/Stable-53b99ce608cba35127ae3a050c1738a959750860/server/bin/remote-cli:/mnt/weka/home/hao.zhang/.local/bin:/usr/local/bin/wekaenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/weka/software/weka/bin'\''
export CONDA_PREFIX='\''/mnt/weka/home/hao.zhang/conda/miniconda'\''
export CONDA_SHLVL='\''3'\''
export CONDA_DEFAULT_ENV='\''base'\''
export CONDA_PROMPT_MODIFIER='\''(base) '\''
export CONDA_PREFIX_2='\''/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv'\''
export CONDA_EXE='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda'\''
export CONDA_PYTHON_EXE='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin/python'\'''
+++ unset _CE_M
+++ unset _CE_CONDA
+++ PS1='(base) '
+++ export PATH=/mnt/weka/home/hao.zhang/conda/miniconda/bin:/mnt/weka/home/hao.zhang/conda/miniconda/condabin:/mnt/weka/home/hao.zhang/.cursor-server/cli/servers/Stable-53b99ce608cba35127ae3a050c1738a959750860/server/bin/remote-cli:/mnt/weka/home/hao.zhang/.local/bin:/usr/local/bin/wekaenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/weka/software/weka/bin
+++ PATH=/mnt/weka/home/hao.zhang/conda/miniconda/bin:/mnt/weka/home/hao.zhang/conda/miniconda/condabin:/mnt/weka/home/hao.zhang/.cursor-server/cli/servers/Stable-53b99ce608cba35127ae3a050c1738a959750860/server/bin/remote-cli:/mnt/weka/home/hao.zhang/.local/bin:/usr/local/bin/wekaenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/weka/software/weka/bin
+++ export CONDA_PREFIX=/mnt/weka/home/hao.zhang/conda/miniconda
+++ CONDA_PREFIX=/mnt/weka/home/hao.zhang/conda/miniconda
+++ export CONDA_SHLVL=3
+++ CONDA_SHLVL=3
+++ export CONDA_DEFAULT_ENV=base
+++ CONDA_DEFAULT_ENV=base
+++ export 'CONDA_PROMPT_MODIFIER=(base) '
+++ CONDA_PROMPT_MODIFIER='(base) '
+++ export CONDA_PREFIX_2=/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv
+++ CONDA_PREFIX_2=/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv
+++ export CONDA_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda
+++ CONDA_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda
+++ export CONDA_PYTHON_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/python
+++ CONDA_PYTHON_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/python
++ __conda_hashr
++ '[' -n '' ']'
++ '[' -n '' ']'
++ hash -r
+ conda activate wei-fv
+ local cmd=activate
+ case "$cmd" in
+ __conda_activate activate wei-fv
+ '[' -n '' ']'
+ local ask_conda
++ PS1='(base) '
++ __conda_exe shell.posix activate wei-fv
++ '[' -n '' ']'
++ /mnt/weka/home/hao.zhang/conda/miniconda/bin/conda shell.posix activate wei-fv
+ ask_conda='unset _CE_M
unset _CE_CONDA
PS1='\''(wei-fv) '\''
export PATH='\''/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv/bin:/mnt/weka/home/hao.zhang/conda/miniconda/condabin:/mnt/weka/home/hao.zhang/.cursor-server/cli/servers/Stable-53b99ce608cba35127ae3a050c1738a959750860/server/bin/remote-cli:/mnt/weka/home/hao.zhang/.local/bin:/usr/local/bin/wekaenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/weka/software/weka/bin'\''
export CONDA_PREFIX='\''/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv'\''
export CONDA_SHLVL='\''4'\''
export CONDA_DEFAULT_ENV='\''wei-fv'\''
export CONDA_PROMPT_MODIFIER='\''(wei-fv) '\''
export CONDA_PREFIX_3='\''/mnt/weka/home/hao.zhang/conda/miniconda'\''
export CONDA_EXE='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda'\''
export CONDA_PYTHON_EXE='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin/python'\'''
+ eval 'unset _CE_M
unset _CE_CONDA
PS1='\''(wei-fv) '\''
export PATH='\''/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv/bin:/mnt/weka/home/hao.zhang/conda/miniconda/condabin:/mnt/weka/home/hao.zhang/.cursor-server/cli/servers/Stable-53b99ce608cba35127ae3a050c1738a959750860/server/bin/remote-cli:/mnt/weka/home/hao.zhang/.local/bin:/usr/local/bin/wekaenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/weka/software/weka/bin'\''
export CONDA_PREFIX='\''/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv'\''
export CONDA_SHLVL='\''4'\''
export CONDA_DEFAULT_ENV='\''wei-fv'\''
export CONDA_PROMPT_MODIFIER='\''(wei-fv) '\''
export CONDA_PREFIX_3='\''/mnt/weka/home/hao.zhang/conda/miniconda'\''
export CONDA_EXE='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda'\''
export CONDA_PYTHON_EXE='\''/mnt/weka/home/hao.zhang/conda/miniconda/bin/python'\'''
++ unset _CE_M
++ unset _CE_CONDA
++ PS1='(wei-fv) '
++ export PATH=/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv/bin:/mnt/weka/home/hao.zhang/conda/miniconda/condabin:/mnt/weka/home/hao.zhang/.cursor-server/cli/servers/Stable-53b99ce608cba35127ae3a050c1738a959750860/server/bin/remote-cli:/mnt/weka/home/hao.zhang/.local/bin:/usr/local/bin/wekaenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/weka/software/weka/bin
++ PATH=/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv/bin:/mnt/weka/home/hao.zhang/conda/miniconda/condabin:/mnt/weka/home/hao.zhang/.cursor-server/cli/servers/Stable-53b99ce608cba35127ae3a050c1738a959750860/server/bin/remote-cli:/mnt/weka/home/hao.zhang/.local/bin:/usr/local/bin/wekaenv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/mnt/weka/software/weka/bin
++ export CONDA_PREFIX=/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv
++ CONDA_PREFIX=/mnt/weka/home/hao.zhang/conda/miniconda/envs/wei-fv
++ export CONDA_SHLVL=4
++ CONDA_SHLVL=4
++ export CONDA_DEFAULT_ENV=wei-fv
++ CONDA_DEFAULT_ENV=wei-fv
++ export 'CONDA_PROMPT_MODIFIER=(wei-fv) '
++ CONDA_PROMPT_MODIFIER='(wei-fv) '
++ export CONDA_PREFIX_3=/mnt/weka/home/hao.zhang/conda/miniconda
++ CONDA_PREFIX_3=/mnt/weka/home/hao.zhang/conda/miniconda
++ export CONDA_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda
++ CONDA_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/conda
++ export CONDA_PYTHON_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/python
++ CONDA_PYTHON_EXE=/mnt/weka/home/hao.zhang/conda/miniconda/bin/python
+ __conda_hashr
+ '[' -n '' ']'
+ '[' -n '' ']'
+ hash -r
+ export WANDB_MODE=online
+ WANDB_MODE=online
+ export NCCL_P2P_DISABLE=1
+ NCCL_P2P_DISABLE=1
+ export TORCH_NCCL_ENABLE_MONITORING=0
+ TORCH_NCCL_ENABLE_MONITORING=0
+ export TRITON_CACHE_DIR=/tmp/triton_cache_0
+ TRITON_CACHE_DIR=/tmp/triton_cache_0
+ export MASTER_PORT=29500
+ MASTER_PORT=29500
+ export NODE_RANK=0
+ NODE_RANK=0
+ nodes=($(scontrol show hostnames $SLURM_JOB_NODELIST))
++ scontrol show hostnames fs-mbz-gpu-141
+ export MASTER_ADDR=fs-mbz-gpu-141
+ MASTER_ADDR=fs-mbz-gpu-141
+ export CUDA_VISIBLE_DEVICES=0
+ CUDA_VISIBLE_DEVICES=0
+ export TOKENIZERS_PARALLELISM=false
+ TOKENIZERS_PARALLELISM=false
+ export WANDB_BASE_URL=https://api.wandb.ai
+ WANDB_BASE_URL=https://api.wandb.ai
+ export WANDB_MODE=online
+ WANDB_MODE=online
+ export FASTVIDEO_ATTENTION_BACKEND=FLASH_ATTN
+ FASTVIDEO_ATTENTION_BACKEND=FLASH_ATTN
+ echo 'MASTER_ADDR: fs-mbz-gpu-141'
+ echo 'NODE_RANK: 0'
+ NUM_GPUS=1
+ GENERATOR_MODEL_PATH=wlsaidhi/SFWan2.1-T2V-1.3B-Diffusers
+ REAL_SCORE_MODEL_PATH=Wan-AI/Wan2.1-T2V-14B-Diffusers
+ FAKE_SCORE_MODEL_PATH=Wan-AI/Wan2.1-T2V-1.3B-Diffusers
+ DATA_DIR=data/crush-smol_processed_t2v/combined_parquet_dataset/
+ VALIDATION_DATASET_FILE=examples/distill/SFWan2.1-I2V/validation.json
+ training_args=(--tracker_project_name SFwan_t2v_distill_dmd --output_dir "checkpoints/SFwan_t2v_finetune" --max_train_steps 1000 --train_batch_size 1 --train_sp_batch_size 1 --gradient_accumulation_steps 1 --num_latent_t 21 --num_height 480 --num_width 832 --num_frames 81 --enable_gradient_checkpointing_type "full")
+ parallel_args=(--num_gpus 1 --sp_size 1 --tp_size 1 --hsdp_replicate_dim 1 --hsdp_shard_dim 1)
+ model_args=(--model_path $GENERATOR_MODEL_PATH --pretrained_model_name_or_path $GENERATOR_MODEL_PATH --generator_model_path $GENERATOR_MODEL_PATH --real_score_model_path $REAL_SCORE_MODEL_PATH --fake_score_model_path $FAKE_SCORE_MODEL_PATH)
+ dataset_args=(--data_path "$DATA_DIR" --dataloader_num_workers 4)
+ validation_args=(--log_validation --validation_dataset_file "$VALIDATION_DATASET_FILE" --validation_steps 200 --validation_sampling_steps "3" --validation_guidance_scale "6.0")
+ optimizer_args=(--learning_rate 2e-6 --mixed_precision "bf16" --training_state_checkpointing_steps 500 --weight_only_checkpointing_steps 500 --weight_decay 0.01 --betas '0.0,0.999' --max_grad_norm 1.0)
+ miscellaneous_args=(--inference_mode False --checkpoints_total_limit 3 --training_cfg_rate 0.0 --dit_precision "fp32" --flow_shift 5 --seed 1000 --use_ema True --ema_decay 0.99 --ema_start_step 200 --init_weights_from_safetensors "/mnt/weka/home/hao.zhang/wl/Self-Forcing/diffusers_ode_init/model.safetensors")
+ dmd_args=(--dmd_denoising_steps '1000,750,500,250' --min_timestep_ratio 0.02 --max_timestep_ratio 0.98 --generator_update_interval 5 --real_score_guidance_scale 3.0 --fake_score_learning_rate 4e-7 --fake_score_betas '0.0,0.999')
+ srun torchrun --nnodes 1 --nproc_per_node 1 --node_rank 0 --rdzv_backend=c10d --rdzv_endpoint=fs-mbz-gpu-141:29500 fastvideo/training/wan_distillation_pipeline.py --num_gpus 1 --sp_size 1 --tp_size 1 --hsdp_replicate_dim 1 --hsdp_shard_dim 1 --model_path wlsaidhi/SFWan2.1-T2V-1.3B-Diffusers --pretrained_model_name_or_path wlsaidhi/SFWan2.1-T2V-1.3B-Diffusers --generator_model_path wlsaidhi/SFWan2.1-T2V-1.3B-Diffusers --real_score_model_path Wan-AI/Wan2.1-T2V-14B-Diffusers --fake_score_model_path Wan-AI/Wan2.1-T2V-1.3B-Diffusers --data_path data/crush-smol_processed_t2v/combined_parquet_dataset/ --dataloader_num_workers 4 --tracker_project_name SFwan_t2v_distill_dmd --output_dir checkpoints/SFwan_t2v_finetune --max_train_steps 1000 --train_batch_size 1 --train_sp_batch_size 1 --gradient_accumulation_steps 1 --num_latent_t 21 --num_height 480 --num_width 832 --num_frames 81 --enable_gradient_checkpointing_type full --learning_rate 2e-6 --mixed_precision bf16 --training_state_checkpointing_steps 500 --weight_only_checkpointing_steps 500 --weight_decay 0.01 --betas 0.0,0.999 --max_grad_norm 1.0 --log_validation --validation_dataset_file examples/distill/SFWan2.1-I2V/validation.json --validation_steps 200 --validation_sampling_steps 3 --validation_guidance_scale 6.0 --inference_mode False --checkpoints_total_limit 3 --training_cfg_rate 0.0 --dit_precision fp32 --flow_shift 5 --seed 1000 --use_ema True --ema_decay 0.99 --ema_start_step 200 --init_weights_from_safetensors /mnt/weka/home/hao.zhang/wl/Self-Forcing/diffusers_ode_init/model.safetensors --dmd_denoising_steps 1000,750,500,250 --min_timestep_ratio 0.02 --max_timestep_ratio 0.98 --generator_update_interval 5 --real_score_guidance_scale 3.0 --fake_score_learning_rate 4e-7 --fake_score_betas 0.0,0.999
